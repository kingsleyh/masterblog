<div class="box grid_8">
  <div class="box-head"><h2>Create New Upload</h2></div>
  <div class="box-content">
    <%= form_for @upload, :as => :upload, :url => admin_create_upload_url, :html => {:multipart => true, :class => 'block-content form'} do |f| %>

        <script type="text/javascript">
            <%- session_key = Rails.application.config.session_options[:key] -%>
            $(function () {

                var uploadify_script_data = {};

                // Fetch the CSRF meta tag data
                var csrf_token = $('meta[name=csrf-token]').attr('content');
                var csrf_param = $('meta[name=csrf-param]').attr('content');

                // Now associate the data in the config, encoding the data safely
                uploadify_script_data[csrf_token] = encodeURI(csrf_param);

                // Associate the session information
                uploadify_script_data['<%= session_key %>'] = '<%= cookies[session_key] %>';

                $('#upload_upload').uploadify({
                    'fileObjName' : 'upload[upload]',
                    'swf'      : '/assets/uploadify-v3.1/uploadify.swf',
                    'uploader'  : '<%= admin_create_upload_url %>',
                    'buttonText' : 'Select Files...',
                    'onQueueComplete' : function(queueData) {
                      window.location.reload();
        }
                });
            });
        </script>

        <div class="form-row">
          <div class="form-item"><%= f.file_field :upload %></div>
        </div>

    <% end %>
    <div class="clear"></div>
  </div>
</div>


<div class="grid_8">
  <% @upload.errors.full_messages.each do |msg| %>
      <div class="ad-notif-error"><p><%= msg %></p></div>
  <% end %>
</div>


<div class="box grid_8">
  <div class="box-head"><h2>Uploads</h2></div>
  <div class="box-content no-pad">
    <table class="display" id="dt3">
      <thead>
      <tr>
        <th>Upload</th>
        <th>Type</th>
        <th>Path</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <% @uploads.sort_by { |x| x.created_at }.reverse.each do |upload| %>
          <tr>
            <td>
              <% if upload.is_image? %>
                  <%= link_to((image_tag upload.upload.url(:medium), :style => "border: 1px solid black;"), upload.upload.url(:original)) %>
              <% else %>
                  <%= link_to(image_tag('mime/text.png', :height => 48, :width => 48), upload.upload.url) %>
              <% end %>
            </td>
            <td align="center"><%= upload.upload_content_type %></td>
            <td align="center"><%= upload.file_name %></td>
            <td align="center"><%= link_to image_tag('cross.png'), admin_delete_upload_path(upload.id), :style => "padding-right:20px;", :class => "confirm", :title => "Are you sure you want to delete this Upload?" %>
            </td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>


<script>
    $('#dt3').dataTable({
        "bJQueryUI":true,
        "sPaginationType":"full_numbers"
    });
</script>



